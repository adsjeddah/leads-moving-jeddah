# Google Sheets Integration Setup ๐

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุฑุจุท ุงููููุน ูุจุงุดุฑุฉ ูุน Google Sheets ูุญูุธ ุทูุจุงุช ุงูุนููุงุก ุจุดูู ุชููุงุฆู ููุญุธู ุจุงุณุชุฎุฏุงู Google Service Account.

## ๐ ุฑุงุจุท Google Sheets
[https://docs.google.com/spreadsheets/d/1PA0drQi1lQuPJzmMiqtBGTq3tfL0x6QGgus5flIN7yE/edit](https://docs.google.com/spreadsheets/d/1PA0drQi1lQuPJzmMiqtBGTq3tfL0x6QGgus5flIN7yE/edit)

## ๐ ุฑุคูุณ ุงูุฃุนูุฏุฉ (35 ุนููุฏ)

| ุงูุนููุฏ | ุงุณู ุงูุญูู | ุงููุตู |
|--------|-----------|--------|
| A | timestamp | ููุช ุงุณุชูุงู ุงูุทูุจ |
| B | lead_id | ุฑูู ุงูุทูุจ ุงููุฑูุฏ |
| C | status | ุญุงูุฉ ุงูุทูุจ (new) |
| D | service_type | ููุน ุงูุฎุฏูุฉ |
| E | additional_services | ุฎุฏูุงุช ุฅุถุงููุฉ |
| F | from_city | ูุฏููุฉ ุงูุงุณุชูุงู |
| G | from_district | ุญู ุงูุงุณุชูุงู |
| H | from_place_type | ููุน ุงูููุงู |
| I | from_floor | ุงูุทุงุจู - ุงุณุชูุงู |
| J | from_elevator | ูุตุนุฏ ูุชุงุญ - ุงุณุชูุงู |
| K | to_city | ูุฏููุฉ ุงูุชุณููู |
| L | to_district | ุญู ุงูุชุณููู |
| M | to_floor | ุงูุทุงุจู - ุชุณููู |
| N | to_elevator | ูุตุนุฏ ูุชุงุญ - ุชุณููู |
| O | items | ูุงุฆูุฉ ุงูุนูุงุตุฑ ูุงููููุงุช |
| P | packaging_level | ูุณุชูู ุงูุชุบููู |
| Q | hoist_needed | ุฑุงูุนุฉ ูุทููุจุฉ |
| R | date_pref | ุงูุชุงุฑูุฎ ุงูููุถู |
| S | time_slot | ุงููุชุฑุฉ ุงูุฒูููุฉ |
| T | flexibility | ูุฑููุฉ ุงูููุนุฏ |
| U | customer_name | ุงุณู ุงูุนููู |
| V | customer_phone | ุฑูู ุงููุงุชู |
| W | whatsapp_optin | ููุงููุฉ ูุงุชุณุงุจ |
| X | notes | ููุงุญุธุงุช ุงูุนููู |
| Y | utm_source | ูุตุฏุฑ ุงูุฒูุงุฑุฉ |
| Z | utm_medium | ูุณูุท ุงูุชุณููู |
| AA | utm_campaign | ุงูุญููุฉ ุงูุชุณููููุฉ |
| BB | utm_term | ุงููุตุทูุญ |
| CC | utm_content | ูุญุชูู ุงูุญููุฉ |
| DD | gclid | Google Click ID |
| EE | device | ููุน ุงูุฌูุงุฒ |
| FF | page_path | ุตูุญุฉ ุงูุฏุฎูู |
| GG | referrer | ุงููููุน ุงููุฑุฌุนู |
| HH | ip | ุนููุงู IP |
| II | currency | ุงูุนููุฉ (SAR) |
| JJ | sla_minutes | ุฒูู ุงูุงุณุชุฌุงุจุฉ |

## ๐๏ธ ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู

### 1. ูุชุบูุฑุงุช ุงูุจูุฆุฉ
ุชู ุฅุถุงูุฉ ุงููุชุบูุฑุงุช ุงูุชุงููุฉ ูู `.env.local`:

```env
GOOGLE_SERVICE_ACCOUNT_KEY={"type":"service_account",...}
GOOGLE_SPREADSHEET_ID=1PA0drQi1lQuPJzmMiqtBGTq3tfL0x6QGgus5flIN7yE  
GOOGLE_SHEET_NAME=fresh leads
```

### 2. Service Account
- **Project ID**: leads-store
- **Service Account Email**: service-account@leads-store.iam.gserviceaccount.com
- **ุงูุฃุฐููุงุช**: Google Sheets API + Drive API

## ๐ ุงูุงุฎุชุจุงุฑ ูุงููุฑุงูุจุฉ

### ุตูุญุฉ ุงูุฅุฏุงุฑุฉ
```
https://your-domain.com/admin-sheets
```

**ุงูููุฒุงุช:**
- ุงุฎุชุจุงุฑ ุงุชุตุงู Google Sheets
- ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช
- ุฅุถุงูุฉ ุฑุคูุณ ุงูุฃุนูุฏุฉ ูุฏููุงู
- ุฑุงุจุท ูุจุงุดุฑ ููุดูุช

### API Endpoints

#### ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
```bash
GET /api/test-sheets
```
**Response:**
```json
{
  "success": true,
  "message": "ุชู ุงูุงุชุตุงู ูุน Google Sheets ุจูุฌุงุญ",
  "data": {
    "sheetTitle": "moving leads",
    "sheetId": "1PA0drQi1lQuPJzmMiqtBGTq3tfL0x6QGgus5flIN7yE",
    "totalLeads": 0,
    "lastUpdate": "2025-01-27T15:36:16.972Z"
  }
}
```

#### ุฅุถุงูุฉ ุฑุคูุณ ุงูุฃุนูุฏุฉ
```bash  
POST /api/test-sheets
```

#### ุฅุฑุณุงู ุทูุจ ุฌุฏูุฏ
```bash
POST /api/lead
```

## ๐ฏ ุฎุตุงุฆุต ุงููุธุงู

### โ ุงููููุฒุงุช
- **ุชุฒุงูู ูุญุธู**: ูู ุทูุจ ููุญูุธ ููุฑุงู
- **ุฃูุงู ุนุงูู**: Service Account ูุน ุฃุฐููุงุช ูุญุฏุฏุฉ
- **ูุธุงู ุงุญุชูุงุทู**: ุงูุนูุฏุฉ ูู Make.com ุนูุฏ ุงููุดู
- **ุชูุณูู ุงุญุชุฑุงูู**: ุฑุคูุณ ููููุฉ ูููุณูุฉ
- **ุจูุงูุงุช ุดุงููุฉ**: 35 ุญูู ููุชุญููู

### ๐ ุขููุฉ ุงูุนูู
1. ุนููู ูููุฃ ุงูููุฑู ุนูู ุงููููุน
2. ุงูุชุทุจูู ูุชุญูู ูู ุงุชุตุงู Google Sheets
3. ุฅุถุงูุฉ ุงูุจูุงูุงุช ูุตู ุฌุฏูุฏ ูู ุงูุดูุช
4. ุชูุณูู ุงูุจูุงูุงุช ุงููุนูุฏุฉ (Arrays โ Text)
5. ุฅุฑุณุงู ุฑุฏ ููุนููู ุจูุฌุงุญ ุงูุนูููุฉ

### ๐ ุชูุณูู ุงูุจูุงูุงุช

#### ุงูุจูุงูุงุช ุงููุฑูุจุฉ
- **items**: `"ุบุฑูุฉ ููู: 2, ุตุงูุฉ: 1, ูุทุจุฎ: 1"`
- **additional_services**: `"ุชุบููู_ูุงูู, ูู_ูุชุฑููุจ"`
- **whatsapp_optin**: `"ูุนู" / "ูุง"`
- **timestamp**: `"2025-01-27T15:36:16.972Z"`

#### ูุนูููุงุช UTM
ุฌููุน ูุนูููุงุช ุงูุชุชุจุน ุงูุชุณูููู ูุญููุธุฉ:
- ูุตุฏุฑ ุงูุฒูุงุฑุฉ (Google, Facebook, etc.)
- ููุน ุงูุญููุฉ (CPC, Organic, etc.)
- ูุนุฑู ุงูููุฑุฉ (GCLID)
- ุงูุตูุญุฉ ุงููุฑุฌุนูุฉ

## ๐จ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ

#### ุฎุทุฃ ูู Service Account
```
Error: Google Sheets connection failed: Unauthorized
```
**ุงูุญู:** ุชุฃูุฏ ูู ุตุญุฉ credentials ูู `.env.local`

#### ุฎุทุฃ ูู ุงูุฃุฐููุงุช
```  
Error: The caller does not have permission
```
**ุงูุญู:** ุชุฃูุฏ ูู ุฅุนุทุงุก Service Account ุญููู ุงูุชุญุฑูุฑ

#### ุฎุทุฃ ูู Spreadsheet ID
```
Error: Unable to parse range
```
**ุงูุญู:** ุชุฃูุฏ ูู ุตุญุฉ ูุนุฑู ุงูุดูุช ูู ุงููุชุบูุฑุงุช

### ูุญุต ุงูุงุชุตุงู
```bash
# ุชุทููุฑ ูุญูู
curl -X GET http://localhost:3000/api/test-sheets

# Production  
curl -X GET https://your-domain.com/api/test-sheets
```

## ๐ ุงูุชูุงุฑูุฑ ูุงูุชุญููู

### ูุคุดุฑุงุช ุงูุฃุฏุงุก
- **ุฅุฌูุงูู ุงูุทูุจุงุช**: ุนุฏุฏ ุงูุตููู - 1 (Header)
- **ูุนุฏู ุงููุฌุงุญ**: ูุฑุงูุจุฉ errors ูู ุงูู logs
- **ุฃููุงุช ุงูุฐุฑูุฉ**: ุชุญููู timestamp
- **ูุตุงุฏุฑ ุงูุชุญููู**: ุชุญููู utm_source

### ุชุตููุฉ ุงูุจูุงูุงุช
ุงุณุชุฎุฏู Google Sheets filters ูุชุญููู:
- ุทูุจุงุช ุญุณุจ ุงูุชุงุฑูุฎ
- ุทูุจุงุช ุญุณุจ ุงูููุทูุฉ
- ุทูุจุงุช ุญุณุจ ูุตุฏุฑ ุงูุชุณููู
- ุทูุจุงุช ุญุณุจ ููุน ุงูุฎุฏูุฉ

## ๐ ุงูุฃูุงู

### Service Account Security
- Private Key ูุญูู ูู environment variables
- ุฃุฐููุงุช ูุญุฏุฏุฉ ููุท ููุดูุช ุงููุทููุจ
- ูุง ูููู ุงููุตูู ููููุงุช ุฃุฎุฑู ูู Drive

### Rate Limiting
- ุญุฏ ุฃูุตู 5 ุทูุจุงุช ูู ุงูุฏูููุฉ ููู IP
- ุญูุงูุฉ ูู ุงูู spam ูุงูุงุณุชุฎุฏุงู ุงูููุฑุท

## ๐ ุงูุฏุนู

ูู ุญุงูุฉ ููุงุฌูุฉ ุฃู ูุดุงูู:
1. ุชุญูู ูู ุตูุญุฉ `/admin-sheets` ุฃููุงู
2. ุฑุงุฌุน ุงูู console logs
3. ุชุฃูุฏ ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
4. ุงุฎุชุจุฑ ุงูุงุชุตุงู ุนุจุฑ API

---

**ุชู ุชุทููุฑ ุงููุธุงู ุจูุฌุงุญ! ๐**
ูู ุทูุจ ุฌุฏูุฏ ุณูุธูุฑ ููุฑุงู ูู Google Sheets ูุน ุฌููุน ุงูุชูุงุตูู ุงููุทููุจุฉ ูููุชุงุจุนุฉ ูุงูุชุญููู.
